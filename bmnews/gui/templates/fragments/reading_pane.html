<article class="paper-detail">
    <h1 class="paper-title">{{ paper.title }}</h1>

    <div class="paper-meta">
        <span class="authors">{{ paper.authors }}</span>
        <span class="sep">&middot;</span>
        <span class="date">{{ paper.published_date }}</span>
        <span class="sep">&middot;</span>
        {% if paper.journal %}
        <span class="journal-name">{{ paper.journal }}</span>
        <span class="sep">&middot;</span>
        {% endif %}
        <span class="source-badge source-{{ paper.source }}">{{ paper.source }}</span>
    </div>

    <div class="score-section">
        <span class="score-badge {% if paper.relevance_score >= 0.7 %}score-high{% elif paper.relevance_score >= 0.5 %}score-mid{% else %}score-low{% endif %}">
            Relevance: {{ (paper.relevance_score * 100)|int }}%
        </span>
        <span class="tier-badge">{{ paper.quality_tier|replace("_", " ") }}</span>
        {% if paper.study_design %}
        <span class="design-badge">{{ paper.study_design|upper }}</span>
        {% endif %}
    </div>

    {% if paper.summary %}
    <section class="summary-section">
        <h2>Summary</h2>
        <p>{{ paper.summary }}</p>
    </section>
    {% endif %}

    <section class="abstract-section">
        <h2>Abstract</h2>
        {{ paper.abstract | format_abstract | safe }}
    </section>

    <div class="paper-actions">
        {% if paper.url %}
        <a href="{{ paper.url }}" target="_blank" class="btn btn-primary">Open DOI &#x2197;</a>
        {% elif paper.doi %}
        <a href="https://doi.org/{{ paper.doi }}" target="_blank" class="btn btn-primary">Open DOI &#x2197;</a>
        {% endif %}

        {% if paper.fulltext_source == 'unpaywall_pdf' and paper.fulltext_html %}
        <a href="{{ paper.fulltext_html }}" target="_blank" class="btn btn-secondary">Open PDF &#x2197;</a>
        {% elif paper.fulltext_source == 'publisher_url' and paper.fulltext_html %}
        <a href="{{ paper.fulltext_html }}" target="_blank" class="btn btn-secondary">Open Publisher Page &#x2197;</a>
        {% elif paper.fulltext_html %}
        <button class="btn btn-secondary fulltext-toggle" onclick="toggleFulltext()">
            Show Full Text
        </button>
        {% else %}
        <button class="btn btn-secondary"
                hx-post="/papers/{{ paper.id }}/fulltext"
                hx-target="#fulltext-container"
                hx-indicator="#fulltext-spinner"
                hx-swap="innerHTML">
            Get Full Text
        </button>
        <span id="fulltext-spinner" class="htmx-indicator">Loading full text...</span>
        {% endif %}
    </div>

    <div id="fulltext-container">
        {% if paper.fulltext_html and paper.fulltext_source not in ('unpaywall_pdf', 'publisher_url') %}
        <section class="fulltext-section" id="fulltext-display" style="display:none;">
            <h2>Full Text <span class="fulltext-source-badge">{{ paper.fulltext_source }}</span></h2>
            <div class="fulltext-content">
                {{ paper.fulltext_html | safe }}
            </div>
        </section>
        {% endif %}
    </div>
</article>
